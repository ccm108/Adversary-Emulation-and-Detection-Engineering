# Adversary Emulation & Detection Engineering – Project Documentation

## 1. Project Overview
This project focuses on adversary emulation modeled after APT29 (Cozy Bear), a well-known Russian intelligence group recognized for its stealthy and long-term cyber-espionage operations. The work was carried out inside a controlled Windows lab environment, where the goal was to safely simulate several MITRE-mapped techniques using Atomic Red Team and observe how those actions appear within Sysmon logs. By recreating these behaviors, the project demonstrates how defenders validate logging coverage, detect malicious behavior, and complete a full attack-and-detect lifecycle similar to what real security teams perform in enterprise environments. The simulation involved five techniques: Scheduled Task, Masquerading, Phishing (Spearphishing Link), DLL Side-Loading, and WMI Execution, with all but WMI Execution running successfully. Throughout the project, Sysmon provided detailed evidence of process activities, file manipulations, and system-level traces that confirmed the success of each executed technique.

## 2. Design & Architecture
The architecture for this project relied entirely on a Windows-based environment configured with Sysmon and Atomic Red Team. All adversary actions were executed through a PowerShell automation script that handled the process of running individual Atomic tests and logging their results. Before execution, the script created a dedicated log directory and generated timestamped files to ensure every run could be easily tracked and audited. Sysmon served as the primary detection mechanism by capturing events such as process creation, command execution, file manipulation, and DLL loading. These logs were later reviewed in Windows Event Viewer to validate that each Atomic test produced the expected footprint. The overall design allowed the team to execute attacks, collect evidence, and analyze system behavior in a single, self-contained workflow.

## 3. Implementation Details
The implementation centered around a PowerShell script that automated the execution of multiple MITRE ATT&CK techniques. The script began by defining a list of technique IDs associated with the tests to be executed. It then checked whether a “Logs” directory existed and created one if necessary. For each execution session, the script generated a timestamped file to store results. A custom function, `Run-Atomic`, was responsible for handling the execution of each technique. This function attempted to run `Invoke-AtomicTest` with the specified technique ID and used a try-catch block to differentiate successful executions from failures. All output—whether success or error—was appended to the log file. After defining the function, the script looped through each technique ID and executed them sequentially. This implementation created a clean, repeatable process for adversary simulation and logging.

## 4. Testing & Validation Results
During testing, five techniques were executed: Scheduled Task (T1053.005), Masquerading (T1036), Spearphishing Link (T1566.002), DLL Side-Loading (T1574.002), and WMI Execution (T1047). Four of the five tests completed successfully, with WMI Execution being the only technique that failed during runtime. Despite the single failure, the testing process generated more than fifty Sysmon events, which confirms that the techniques produced measurable system behavior. These events included detailed logs of process execution, file manipulation, command-line activity, DLL loading, and other system changes. The timestamped log files created by the PowerShell script also confirmed correct execution of the techniques and provided a reference for cross-checking Sysmon data. Overall, the validation demonstrated that the environment captured the expected adversary behaviors and logged them in a reliable and actionable manner.

## 5. Security Considerations
All testing took place inside an isolated lab environment to ensure there was no operational risk or exposure to real systems. The Atomic Red Team tests executed were safe, non-destructive simulations designed specifically for controlled environments. Since no databases, personal information, or sensitive files were involved at any stage, there was zero risk of data loss or compromise. Windows security features, including built-in protective controls, remained active during testing, further reducing the chance of unintended behavior. Sysmon’s extensive logging capability allowed the team to verify that every event was accounted for, making it easier to ensure that only authorized behavior occurred throughout the project.

## 6. Limitations & Future Improvements
One of the primary limitations of the project was the inability to use Kali Linux as part of the testing environment since both Sysmon and Atomic Red Team are designed specifically for Windows systems. As a result, all testing had to be performed on Windows, which reduced opportunities for broader cross-platform experimentation. Future improvements may involve expanding the environment by integrating detection tools such as ELK, Splunk, or Wazuh to build dashboards and correlation rules. Additional MITRE techniques could be executed to enhance overall coverage, and the detection engineering stage could be expanded by writing Sigma rules or Windows event filtering policies. More advanced testing environments may also include pivoting or lateral movement simulations to reflect real-world adversary behavior.

## 7. Outside Libraries / Tools Used
The project used a small set of external tools that served distinct roles. Atomic Red Team provided the implementations of each MITRE technique and allowed the team to run safe adversary simulations without risk. Sysmon served as the core logging engine, capturing events such as process creation, file modification, registry interaction, and DLL loading. The MITRE ATT&CK Framework provided the taxonomy and structure for classifying the techniques that were executed. Together, these tools created a complete pathway for simulating attacks, collecting evidence, and validating system detection capability.

## 8. User Manual
To run this project, the user must have a Windows operating system with Sysmon and Atomic Red Team installed. After cloning the repository, the user should open PowerShell inside the project directory and run the included script. The script automatically handles the setup of log directories, executes all configured MITRE techniques, and saves the results in timestamped log files. Once the tests are complete, the user can navigate to the “Logs” folder to review the outputs. To analyze behavior in greater detail, the user should open Event Viewer and review Sysmon logs, focusing on process creation, file changes, and command-line execution events. Following these steps will allow anyone to replicate the adversary simulation and verify the system’s detection capabilities.

## 9. Function Documentation (PowerShell Script)
The PowerShell script contains one primary function, `Run-Atomic`, which is responsible for executing individual MITRE techniques through Atomic Red Team. The function accepts a single parameter, the MITRE technique ID, and handles all printing, execution, and logging details for that test. The process begins by announcing the technique being executed, then attempts to run it using `Invoke-AtomicTest`. If the test executes successfully, the output is captured and appended to the log file. If it fails, the error message is logged instead. The main body of the script defines a list of technique IDs, creates the log directory if needed, generates the timestamped log file, and loops through the list while calling `Run-Atomic` for each technique. This design ensures the script is modular, repeatable, and easy to extend by simply adding additional technique IDs to the list.
